var canvasWidth,canvasHeight;angular.module("myApp",[]).run(["$translate","$log","realTimeService","randomService",function(a,b,c,d){"use strict";function e(a){function b(b){v=b.yourPlayerIndex,w=b.playersInfo,x=b.matchController;var c=[];n.sprites=c;var d=new g;d.x=n.canvasWidth/2,d.y=n.canvasHeight/2,d.game=n,c.push(d),d.bullets=[];for(var e=0;10>e;e++){var f=new i;f.game=n,d.bullets.push(f),c.push(f)}n.ship=d;var j=new h;j.setup(),j.game=n,c.push(j),n.bigAlien=j;var k=new g;k.scale=.6,k.visible=!0,k.preMove=null,k.children=[];var e,l=!1,m=!1,s=0,t=0,u=0,y=Date.now(),z=void 0,A=void 0,B=void 0,C=function(){if(Text.context=o,Sprite.prototype.context=o,Sprite.prototype.grid=r,o.clearRect(0,0,n.canvasWidth,n.canvasHeight),n.FSM.execute(),KEY_STATUS.g){o.beginPath();for(var b=0;p>b;b++)o.moveTo(b*GRID_SIZE,0),o.lineTo(b*GRID_SIZE,n.canvasHeight);for(var d=0;q>d;d++)o.moveTo(0,d*GRID_SIZE),o.lineTo(n.canvasWidth,d*GRID_SIZE);o.closePath(),o.stroke()}for(z=Date.now(),A=z-y,y=z,B=A/30,b=0;b<c.length;b++)c[b].run(B),c[b].reap&&(c[b].reap=!1,c.splice(b,1),b--);var e=""+n.score;for(Text.renderText(e,18,n.canvasWidth-14*e.length,20),b=0;b<n.lives;b++)o.save(),k.x=n.canvasWidth-8*(b+1),k.y=32,k.configureTransform(),k.draw(),o.restore();m&&Text.renderText(""+s,24,n.canvasWidth-38,n.canvasHeight-2),t++,u+=A,u>1e3&&(u-=1e3,s=t,t=0),l?Text.renderText("PAUSED",72,n.canvasWidth/2-160,120):requestAnimFrame(C,a)};C()}function c(){}function e(){}var g=function(){this.init("ship",[-5,4,0,-12,5,4]),this.children.exhaust=new Sprite,this.children.exhaust.init("exhaust",[-3,6,0,11,3,6]),this.bulletCounter=0,this.postMove=this.wrapPostMove,this.collidesWith=["asteroid","bigalien","alienbullet"],this.preMove=function(a){if(this.vel.rot=KEY_STATUS.left?-6:KEY_STATUS.right?6:0,KEY_STATUS.up){var b=(this.rot-90)*Math.PI/180;this.acc.x=.5*Math.cos(b),this.acc.y=.5*Math.sin(b),this.children.exhaust.visible=d.random(3)>.1}else this.acc.x=0,this.acc.y=0,this.children.exhaust.visible=!1;if(this.bulletCounter>0&&(this.bulletCounter-=a),KEY_STATUS.space&&this.bulletCounter<=0){this.bulletCounter=10;for(var c=0;c<this.bullets.length;c++)if(!this.bullets[c].visible){f.laser();var e=this.bullets[c],b=(this.rot-90)*Math.PI/180,g=Math.cos(b),h=Math.sin(b);e.x=this.x+4*g,e.y=this.y+4*h,e.vel.x=6*g+this.vel.x,e.vel.y=6*h+this.vel.y,e.visible=!0;break}}Math.sqrt(this.vel.x*this.vel.x+this.vel.y*this.vel.y)>8&&(this.vel.x*=.95,this.vel.y*=.95)},this.collision=function(a){f.explosion(),n.explosionAt(a.x,a.y),n.FSM.state="player_died",this.visible=!1,this.currentNode.leave(this),this.currentNode=null,n.lives--}};g.prototype=new Sprite;var h=function(){this.init("bigalien",[-20,0,-12,-4,12,-4,20,0,12,4,-12,4,-20,0,20,0]),this.children.top=new Sprite,this.children.top.init("bigalien_top",[-8,-4,-6,-6,6,-6,8,-4]),this.children.top.visible=!0,this.children.bottom=new Sprite,this.children.bottom.init("bigalien_top",[8,4,6,6,-6,6,-8,4]),this.children.bottom.visible=!0,this.collidesWith=["asteroid","ship","bullet"],this.bridgesH=!1,this.bullets=[],this.bulletCounter=0,this.newPosition=function(){d.random(3)<.5?(this.x=-20,this.vel.x=1.5):(this.x=n.canvasWidth+20,this.vel.x=-1.5),this.y=d.random(3)*n.canvasHeight},this.setup=function(){this.newPosition();for(var a=0;3>a;a++){var b=new j;this.bullets.push(b),n.sprites.push(b)}},this.preMove=function(a){var b=this.currentNode;if(null!=b){var c=0;b.north.nextSprite&&c++,b.north.east.nextSprite&&c++,b.north.west.nextSprite&&c++;var e=0;if(b.south.nextSprite&&e++,b.south.east.nextSprite&&e++,b.south.west.nextSprite&&e++,c>e?this.vel.y=1:e>c?this.vel.y=-1:d.random(3)<.01&&(this.vel.y=-this.vel.y),this.bulletCounter-=a,this.bulletCounter<=0){this.bulletCounter=22;for(var g=0;g<this.bullets.length;g++)if(!this.bullets[g].visible){var h=this.bullets[g],i=2*Math.PI*d.random(3),j=Math.cos(i),k=Math.sin(i);h.x=this.x,h.y=this.y,h.vel.x=6*j,h.vel.y=6*k,h.visible=!0,f.laser();break}}}},h.prototype.collision=function(a){"bullet"==a.name&&(n.score+=200),f.explosion(),n.explosionAt(a.x,a.y),this.visible=!1,this.newPosition()},this.postMove=function(){this.y>n.canvasHeight?this.y=0:this.y<0&&(this.y=n.canvasHeight),(this.vel.x>0&&this.x>n.canvasWidth+20||this.vel.x<0&&this.x<-20)&&(this.visible=!1,this.newPosition())}};h.prototype=new Sprite;var i=function(){this.init("bullet",[0,0]),this.time=0,this.bridgesH=!1,this.bridgesV=!1,this.postMove=this.wrapPostMove,this.configureTransform=function(){},this.draw=function(){this.visible&&(this.context.save(),this.context.lineWidth=2,this.context.beginPath(),this.context.moveTo(this.x-1,this.y-1),this.context.lineTo(this.x+1,this.y+1),this.context.moveTo(this.x+1,this.y-1),this.context.lineTo(this.x-1,this.y+1),this.context.stroke(),this.context.restore())},this.preMove=function(a){this.visible&&(this.time+=a),this.time>50&&(this.visible=!1,this.time=0)},this.collision=function(){this.time=0,this.visible=!1,this.currentNode.leave(this),this.currentNode=null},this.transformedPoints=function(){return[this.x,this.y]}};i.prototype=new Sprite;var j=function(){this.init("alienbullet"),this.draw=function(){this.visible&&(this.context.save(),this.context.lineWidth=2,this.context.beginPath(),this.context.moveTo(this.x,this.y),this.context.lineTo(this.x-this.vel.x,this.y-this.vel.y),this.context.stroke(),this.context.restore())}};j.prototype=new i;var k=function(){this.init("asteroid",[-10,0,-5,7,-3,4,1,10,5,4,10,0,5,-6,2,-10,-4,-10,-4,-5]),this.visible=!0,this.scale=6,this.postMove=this.wrapPostMove,this.collidesWith=["ship","bullet","bigalien","alienbullet"],this.collision=function(a){if(f.explosion(),"bullet"==a.name&&(n.score+=120/this.scale),this.scale/=3,this.scale>.5)for(var b=0;3>b;b++){var c=$.extend(!0,{},this);c.vel.x=6*d.random(3)-3,c.vel.y=6*d.random(3)-3,d.random(3)>.5&&c.points.reverse(),c.vel.rot=2*d.random(3)-1,c.move(3*c.scale),n.sprites.push(c)}n.explosionAt(a.x,a.y),this.die()}};k.prototype=new Sprite;var l=function(){this.init("explosion"),this.bridgesH=!1,this.bridgesV=!1,this.lines=[];for(var a=0;5>a;a++){var b=2*Math.PI*d.random(3),c=Math.cos(b),e=Math.sin(b);this.lines.push([c,e,2*c,2*e])}this.draw=function(){if(this.visible){this.context.save(),this.context.lineWidth=1/this.scale,this.context.beginPath();for(var a=0;5>a;a++){var b=this.lines[a];this.context.moveTo(b[0],b[1]),this.context.lineTo(b[2],b[3])}this.context.stroke(),this.context.restore()}},this.preMove=function(a){this.visible&&(this.scale+=a),this.scale>8&&this.die()}};l.prototype=new Sprite;var m=function(){this.north=null,this.south=null,this.east=null,this.west=null,this.nextSprite=null,this.dupe={horizontal:null,vertical:null},this.enter=function(a){a.nextSprite=this.nextSprite,this.nextSprite=a},this.leave=function(a){for(var b=this;b&&b.nextSprite!=a;)b=b.nextSprite;b&&(b.nextSprite=a.nextSprite,a.nextSprite=null)},this.eachSprite=function(a,b){for(var c=this;c.nextSprite;)c=c.nextSprite,b.call(a,c)},this.isEmpty=function(a){for(var b=!0,c=this;c.nextSprite&&(c=c.nextSprite,b=!c.visible||-1==a.indexOf(c.name)););return b}},n={score:0,totalAsteroids:5,lives:0,canvasWidth:1e3,canvasHeight:600,sprites:[],ship:null,bigAlien:null,nextBigAlienTime:null,spawnAsteroids:function(a){a||(a=this.totalAsteroids);for(var b=0;a>b;b++){var c=new k;for(c.x=d.random(3)*this.canvasWidth,c.y=d.random(3)*this.canvasHeight;!c.isClear();)c.x=d.random(3)*this.canvasWidth,c.y=d.random(3)*this.canvasHeight;c.vel.x=4*d.random(3)-2,c.vel.y=4*d.random(3)-2,d.random(3)>.5&&c.points.reverse(),c.vel.rot=2*d.random(3)-1,n.sprites.push(c)}},explosionAt:function(a,b){var c=new l;c.x=a,c.y=b,c.visible=!0,n.sprites.push(c)},FSM:{boot:function(){n.spawnAsteroids(5),this.state="waiting"},waiting:function(){Text.renderText(window.ipad?"Touch Screen to Start":"Press Space to Start",36,n.canvasWidth/2-270,n.canvasHeight/2),(KEY_STATUS.space||window.gameStart)&&(KEY_STATUS.space=!1,window.gameStart=!1,this.state="start")},start:function(){for(var a=0;a<n.sprites.length;a++)"asteroid"==n.sprites[a].name?n.sprites[a].die():("bullet"==n.sprites[a].name||"bigalien"==n.sprites[a].name)&&(n.sprites[a].visible=!1);n.score=0,n.lives=2,n.totalAsteroids=2,n.spawnAsteroids(),n.nextBigAlienTime=Date.now()+3e4+3e4*d.random(3),this.state="spawn_ship"},spawn_ship:function(){n.ship.x=n.canvasWidth/2,n.ship.y=n.canvasHeight/2,n.ship.isClear()&&(n.ship.rot=0,n.ship.vel.x=0,n.ship.vel.y=0,n.ship.visible=!0,this.state="run")},run:function(){for(var a=0;a<n.sprites.length&&"asteroid"!=n.sprites[a].name;a++);a==n.sprites.length&&(this.state="new_level"),!n.bigAlien.visible&&Date.now()>n.nextBigAlienTime&&(n.bigAlien.visible=!0,n.nextBigAlienTime=Date.now()+3e4*d.random(3))},new_level:function(){null==this.timer&&(this.timer=Date.now()),Date.now()-this.timer>1e3&&(this.timer=null,n.totalAsteroids++,n.totalAsteroids>12&&(n.totalAsteroids=12),n.spawnAsteroids(),this.state="run")},player_died:function(){n.lives<0?this.state="end_game":(null==this.timer&&(this.timer=Date.now()),Date.now()-this.timer>1e3&&(this.timer=null,this.state="spawn_ship"))},end_game:function(){Text.renderText("GAME OVER",50,n.canvasWidth/2-160,n.canvasHeight/2+10),null==this.timer&&(this.timer=Date.now()),Date.now()-this.timer>5e3&&(this.timer=null,this.state="waiting"),window.gameStart=!1},execute:function(){this[this.state]()},state:"boot"}};canvasWidth=n.canvasWidth=a.width,canvasHeight=n.canvasHeight=a.height;var o=a.getContext("2d");Text.face=vector_battle;for(var p=Math.round(n.canvasWidth/GRID_SIZE),q=Math.round(n.canvasHeight/GRID_SIZE),r=new Array(p),s=0;p>s;s++){r[s]=new Array(q);for(var t=0;q>t;t++)r[s][t]=new m}for(var s=0;p>s;s++)for(var t=0;q>t;t++){var u=r[s][t];u.north=r[s][0==t?q-1:t-1],u.south=r[s][t==q-1?0:t+1],u.west=r[0==s?p-1:s-1][t],u.east=r[s==p-1?0:s+1][t]}for(var s=0;p>s;s++)r[s][0].dupe.vertical=n.canvasHeight,r[s][q-1].dupe.vertical=-n.canvasHeight;for(var t=0;q>t;t++)r[0][t].dupe.horizontal=n.canvasWidth,r[p-1][t].dupe.horizontal=-n.canvasWidth;Sprite.prototype.matrix=new Matrix(2,3);var v,w,x;return $(window).keydown(function(a){switch(KEY_CODES[a.keyCode]){case"f":showFramerate=!showFramerate;break;case"p":paused=!paused,paused||(lastFrame=Date.now(),mainLoop());break;case"m":f.muted=!f.muted}}),{gotStartMatch:b,gotMessage:c,gotEndMatch:e}}var f={laser:new Audio("audio/39459__THE_bizniss__laser.wav"),explosion:new Audio("audio/51467__smcameron__missile_explosion.wav")};for(var g in f)!function(){var a=f[g];a.muted=!0,a.play(),f[g]=function(){return this.muted||(0===a.duration?(a.load(),a.play()):(a.muted=!1,a.currentTime=0)),a}}();f.muted=!0,c.init({createCanvasController:e,canvasWidth:1600,canvasHeight:600})}]);
//# sourceMappingURL=game.min.js.map